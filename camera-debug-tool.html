<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¹´ë©”ë¼ ì „í™˜ ë””ë²„ê·¸ ë„êµ¬</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        
        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #00ff88;
            border-bottom: 2px solid #00ff88;
            padding-bottom: 10px;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        input, select {
            width: 100%;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: white;
        }
        
        .log {
            background: #000;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .success { color: #00ff88; }
        .warning { color: #ffc107; }
        .error { color: #ff6b6b; }
        
        #preview-canvas {
            width: 100%;
            max-width: 600px;
            height: 400px;
            border: 2px solid #007bff;
            border-radius: 8px;
            margin: 20px auto;
            display: block;
        }
        
        .state-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .state-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 4px;
        }
        
        .state-label {
            color: #888;
            font-size: 12px;
        }
        
        .state-value {
            color: #00ff88;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ”§ ì¹´ë©”ë¼ ì „í™˜ ë””ë²„ê·¸ ë„êµ¬</h1>
        
        <div class="section">
            <h2>1. ì¹´ë©”ë¼ ì „í™˜ í…ŒìŠ¤íŠ¸</h2>
            <div class="controls">
                <div>
                    <label>ì „í™˜ ìœ í˜•:</label>
                    <select id="transition-type">
                        <option value="position">ìœ„ì¹˜ë§Œ</option>
                        <option value="rotation">íšŒì „ë§Œ</option>
                        <option value="both">ìœ„ì¹˜ + íšŒì „</option>
                        <option value="fov">FOV ë³€ê²½</option>
                        <option value="orbit">ê¶¤ë„ ì´ë™</option>
                        <option value="focus">ì˜¤ë¸Œì íŠ¸ í¬ì»¤ìŠ¤</option>
                    </select>
                </div>
                <div>
                    <label>ì§€ì† ì‹œê°„ (ì´ˆ):</label>
                    <input type="number" id="duration" value="1.5" min="0.1" max="5" step="0.1">
                </div>
                <div>
                    <label>ì´ì§• í•¨ìˆ˜:</label>
                    <select id="easing">
                        <option value="linear">Linear</option>
                        <option value="easeInQuad">Ease In Quad</option>
                        <option value="easeOutQuad">Ease Out Quad</option>
                        <option value="easeInOutQuad">Ease In Out Quad</option>
                        <option value="easeInCubic">Ease In Cubic</option>
                        <option value="easeOutCubic">Ease Out Cubic</option>
                        <option value="easeInOutCubic" selected>Ease In Out Cubic</option>
                        <option value="easeInOutSine">Ease In Out Sine</option>
                        <option value="easeOutElastic">Ease Out Elastic</option>
                    </select>
                </div>
                <div>
                    <label>ì»¨íŠ¸ë¡¤ ë¹„í™œì„±í™”:</label>
                    <select id="disable-controls">
                        <option value="true">ì˜ˆ</option>
                        <option value="false">ì•„ë‹ˆì˜¤</option>
                    </select>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <button onclick="testTransition()">ì „í™˜ í…ŒìŠ¤íŠ¸</button>
                <button onclick="cancelTransition()">ì „í™˜ ì·¨ì†Œ</button>
                <button onclick="queueMultiple()">ë‹¤ì¤‘ ì „í™˜ í</button>
            </div>
        </div>
        
        <div class="section">
            <h2>2. ì´ì§• í•¨ìˆ˜ í”„ë¦¬ë·°</h2>
            <canvas id="preview-canvas"></canvas>
            <div class="controls">
                <button onclick="previewAllEasings()">ëª¨ë“  ì´ì§• ë¹„êµ</button>
                <button onclick="animatePreview()">ì• ë‹ˆë©”ì´ì…˜ í”„ë¦¬ë·°</button>
            </div>
        </div>
        
        <div class="section">
            <h2>3. ì¹´ë©”ë¼ ìƒíƒœ</h2>
            <div class="state-display" id="camera-state">
                <div class="state-item">
                    <div class="state-label">ìœ„ì¹˜ X</div>
                    <div class="state-value" id="pos-x">0</div>
                </div>
                <div class="state-item">
                    <div class="state-label">ìœ„ì¹˜ Y</div>
                    <div class="state-value" id="pos-y">0</div>
                </div>
                <div class="state-item">
                    <div class="state-label">ìœ„ì¹˜ Z</div>
                    <div class="state-value" id="pos-z">0</div>
                </div>
                <div class="state-item">
                    <div class="state-label">íšŒì „ X</div>
                    <div class="state-value" id="rot-x">0</div>
                </div>
                <div class="state-item">
                    <div class="state-label">íšŒì „ Y</div>
                    <div class="state-value" id="rot-y">0</div>
                </div>
                <div class="state-item">
                    <div class="state-label">íšŒì „ Z</div>
                    <div class="state-value" id="rot-z">0</div>
                </div>
                <div class="state-item">
                    <div class="state-label">FOV</div>
                    <div class="state-value" id="fov">75</div>
                </div>
                <div class="state-item">
                    <div class="state-label">ì „í™˜ ì¤‘</div>
                    <div class="state-value" id="transitioning">ì•„ë‹ˆì˜¤</div>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <button onclick="saveState()">í˜„ì¬ ìƒíƒœ ì €ì¥</button>
                <button onclick="restoreState()">ì €ì¥ëœ ìƒíƒœ ë³µì›</button>
                <button onclick="resetCamera()">ì¹´ë©”ë¼ ë¦¬ì…‹</button>
            </div>
        </div>
        
        <div class="section">
            <h2>4. ì„±ëŠ¥ ëª¨ë‹ˆí„°</h2>
            <div class="state-display">
                <div class="state-item">
                    <div class="state-label">FPS</div>
                    <div class="state-value" id="fps">0</div>
                </div>
                <div class="state-item">
                    <div class="state-label">ì „í™˜ ì‹œê°„</div>
                    <div class="state-value" id="transition-time">0ms</div>
                </div>
                <div class="state-item">
                    <div class="state-label">í ê¸¸ì´</div>
                    <div class="state-value" id="queue-length">0</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>5. ë¡œê·¸</h2>
            <div class="log" id="debug-log"></div>
            <div style="margin-top: 10px;">
                <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
                <button onclick="exportLog()">ë¡œê·¸ ë‚´ë³´ë‚´ê¸°</button>
            </div>
        </div>
    </div>
    
    <script>
        // ë””ë²„ê·¸ ë¡œê·¸ í•¨ìˆ˜
        function log(message, type = 'info') {
            const logEl = document.getElementById('debug-log');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${time}] ${message}`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        // ì „í™˜ í…ŒìŠ¤íŠ¸
        function testTransition() {
            const type = document.getElementById('transition-type').value;
            const duration = parseFloat(document.getElementById('duration').value);
            const easing = document.getElementById('easing').value;
            const disableControls = document.getElementById('disable-controls').value === 'true';
            
            log(`ì „í™˜ ì‹œì‘: ${type}, ${duration}ì´ˆ, ${easing}`, 'success');
            
            // ì‹¤ì œ ì•±ê³¼ ì—°ë™í•˜ëŠ” ì½”ë“œ
            if (window.parent && window.parent.viewerApp) {
                const app = window.parent.viewerApp;
                const camera = app.sceneManager.camera;
                const transition = app.sceneManager.cameraTransition;
                
                switch(type) {
                    case 'position':
                        const newPos = new THREE.Vector3(
                            Math.random() * 20 - 10,
                            Math.random() * 10 + 5,
                            Math.random() * 20 - 10
                        );
                        transition.transitionTo(newPos, null, camera.fov, {
                            duration,
                            easing,
                            disableControls
                        });
                        break;
                        
                    case 'orbit':
                        const angle = Math.random() * Math.PI * 2;
                        app.sceneManager.setCameraView(`orbit-${Math.floor(angle * 180 / Math.PI)}`, {
                            duration,
                            easing
                        });
                        break;
                        
                    // ë‹¤ë¥¸ ì¼€ì´ìŠ¤ë“¤...
                }
            } else {
                log('ë·°ì–´ ì•±ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. iframe ë‚´ì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”.', 'error');
            }
        }
        
        // ì „í™˜ ì·¨ì†Œ
        function cancelTransition() {
            log('ì „í™˜ ì·¨ì†Œ ìš”ì²­', 'warning');
            
            if (window.parent && window.parent.viewerApp) {
                window.parent.viewerApp.sceneManager.cancelCameraTransition();
            }
        }
        
        // ì´ì§• í•¨ìˆ˜ í”„ë¦¬ë·°
        function previewAllEasings() {
            const canvas = document.getElementById('preview-canvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // ìº”ë²„ìŠ¤ í´ë¦¬ì–´
            ctx.clearRect(0, 0, width, height);
            
            // ì´ì§• í•¨ìˆ˜ë“¤
            const easings = {
                linear: (t) => t,
                easeInQuad: (t) => t * t,
                easeOutQuad: (t) => t * (2 - t),
                easeInOutQuad: (t) => t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t,
                easeInCubic: (t) => t * t * t,
                easeOutCubic: (t) => (--t) * t * t + 1,
                easeInOutCubic: (t) => t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1,
                easeOutElastic: (t) => {
                    const p = 0.3;
                    return Math.pow(2, -10 * t) * Math.sin((t - p / 4) * (2 * Math.PI) / p) + 1;
                }
            };
            
            // ê° ì´ì§• í•¨ìˆ˜ ê·¸ë¦¬ê¸°
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#feca57', '#ff9ff3', '#54a0ff', '#48dbfb', '#0abde3'];
            let colorIndex = 0;
            
            Object.entries(easings).forEach(([name, easing]) => {
                ctx.strokeStyle = colors[colorIndex++ % colors.length];
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let i = 0; i <= 100; i++) {
                    const t = i / 100;
                    const x = t * width;
                    const y = height - (easing(t) * height);
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                
                ctx.stroke();
            });
            
            log('ì´ì§• í•¨ìˆ˜ í”„ë¦¬ë·° ìƒì„±ë¨', 'success');
        }
        
        // ìƒíƒœ ì—…ë°ì´íŠ¸ (ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰)
        function updateCameraState() {
            if (window.parent && window.parent.viewerApp) {
                const camera = window.parent.viewerApp.sceneManager.camera;
                const transition = window.parent.viewerApp.sceneManager.cameraTransition;
                
                document.getElementById('pos-x').textContent = camera.position.x.toFixed(2);
                document.getElementById('pos-y').textContent = camera.position.y.toFixed(2);
                document.getElementById('pos-z').textContent = camera.position.z.toFixed(2);
                document.getElementById('rot-x').textContent = (camera.rotation.x * 180 / Math.PI).toFixed(2) + 'Â°';
                document.getElementById('rot-y').textContent = (camera.rotation.y * 180 / Math.PI).toFixed(2) + 'Â°';
                document.getElementById('rot-z').textContent = (camera.rotation.z * 180 / Math.PI).toFixed(2) + 'Â°';
                document.getElementById('fov').textContent = camera.fov.toFixed(1);
                document.getElementById('transitioning').textContent = transition.isTransitioning ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤';
                
                if (transition.getDebugInfo) {
                    const debug = transition.getDebugInfo();
                    document.getElementById('queue-length').textContent = debug.queueLength || 0;
                }
            }
            
            requestAnimationFrame(updateCameraState);
        }
        
        // ë¡œê·¸ ì§€ìš°ê¸°
        function clearLog() {
            document.getElementById('debug-log').innerHTML = '';
            log('ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤', 'success');
        }
        
        // ì´ˆê¸°í™”
        updateCameraState();
        log('ì¹´ë©”ë¼ ì „í™˜ ë””ë²„ê·¸ ë„êµ¬ ì¤€ë¹„ ì™„ë£Œ', 'success');
    </script>
</body>
</html>