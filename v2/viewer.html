<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>옹벽 3D 뷰어 v2</title>
    <link rel="stylesheet" href="assets/styles/main.css">
</head>
<body>
    <!-- 메인 앱 컨테이너 -->
    <div id="app" class="app-container">
        
        <!-- 헤더 -->
        <header class="header">
            <h1 class="title">옹벽 3D 뷰어 v2</h1>
            <div class="model-selector">
                <!-- 모델 버튼들이 동적으로 생성됨 -->
            </div>
        </header>
        
        <!-- 메인 뷰어 영역 -->
        <main class="main-content">
            <div id="viewer" class="viewer-container"></div>
            
            <!-- 컨트롤 패널 -->
            <div id="controls" class="controls-panel">
                <div class="control-group">
                    <label>카메라</label>
                    <select id="camera-select">
                        <option value="default">기본 카메라</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>뷰 모드</label>
                    <div class="view-buttons">
                        <button id="view-front" class="view-btn">정면</button>
                        <button id="view-side" class="view-btn">측면</button>
                        <button id="view-top" class="view-btn">상단</button>
                        <button id="view-iso" class="view-btn">아이소</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>핫스팟</label>
                    <div class="hotspot-controls">
                        <button id="toggle-hotspots" class="control-btn">핫스팟 토글</button>
                        <select id="hotspot-filter">
                            <option value="all">모든 타입</option>
                            <option value="normal">정상</option>
                            <option value="warning">경고</option>
                            <option value="danger">위험</option>
                        </select>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>기타</label>
                    <div class="other-controls">
                        <button id="reset-camera" class="control-btn">카메라 리셋</button>
                        <button id="toggle-grid" class="control-btn">그리드 토글</button>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- 애니메이션 타임라인 -->
        <div id="timeline" class="timeline-container" style="display: none;">
            <button id="play-btn" class="timeline-btn">
                <span class="play-icon">▶</span>
            </button>
            
            <div class="timeline-track">
                <input type="range" id="timeline-slider" class="timeline-slider" 
                       min="0" max="100" value="0">
                <div class="timeline-progress"></div>
            </div>
            
            <div class="timeline-time">
                <span id="current-time">0:00</span> / 
                <span id="total-time">0:00</span>
            </div>
            
            <div class="timeline-options">
                <label class="checkbox-label">
                    <input type="checkbox" id="sensor-mode" checked>
                    <span>센서 모드 (균열까지만)</span>
                </label>
            </div>
        </div>
        
        <!-- 로딩 화면 -->
        <div id="loading" class="loading-overlay" style="display: none;">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p class="loading-text">모델 로딩 중...</p>
            </div>
        </div>
        
        <!-- 에러 메시지 -->
        <div id="error" class="error-overlay" style="display: none;">
            <div class="error-content">
                <h3>오류 발생</h3>
                <p id="error-message">알 수 없는 오류가 발생했습니다.</p>
                <button id="error-close" class="error-btn">닫기</button>
            </div>
        </div>
        
        <!-- 핫스팟 정보 패널 -->
        <div id="hotspot-info" class="hotspot-info-panel" style="display: none;">
            <div class="hotspot-info-header">
                <h4 id="hotspot-title">센서 정보</h4>
                <button id="hotspot-close" class="close-btn">×</button>
            </div>
            <div class="hotspot-info-body">
                <!-- 센서 정보가 동적으로 표시됨 -->
            </div>
        </div>
    </div>
    
    <!-- Three.js 라이브러리 -->
    <script src="../js/three/three.min.js"></script>
    <script src="../js/three/GLTFLoader.js"></script>
    <script src="../js/three/OrbitControls.js"></script>
    
    <!-- 메인 애플리케이션 -->
    <script type="module" src="src/WallViewer.js"></script>
    
    <!-- 앱 초기화 -->
    <script type="module">
        import { WallViewer } from './src/WallViewer.js';
        
        // 설정 로드 후 뷰어 시작
        async function startApp() {
            try {
                const response = await fetch('./config.json');
                const config = await response.json();
                
                const viewer = new WallViewer(config);
                await viewer.init();
                
                // 전역 접근 (디버깅용)
                window.wallViewer = viewer;
                
                console.log('✅ 옹벽 3D 뷰어 v2 시작 완료');
                
            } catch (error) {
                console.error('❌ 앱 시작 실패:', error);
                document.getElementById('error-message').textContent = error.message;
                document.getElementById('error').style.display = 'flex';
            }
        }
        
        // DOM 로드 완료 후 앱 시작
        document.addEventListener('DOMContentLoaded', startApp);
    </script>
</body>
</html>