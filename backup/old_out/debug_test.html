<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¹ë²½ 3D ë·°ì–´ - ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #00ff88;
            border-bottom: 2px solid #00ff88;
            padding-bottom: 10px;
        }
        .test-section {
            background: rgba(255,255,255,0.05);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-section h2 {
            color: #007bff;
            margin-top: 0;
        }
        .success { color: #00ff88; }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        .info { color: #4488ff; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-family: monospace;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        code {
            background: rgba(0,123,255,0.2);
            padding: 2px 5px;
            border-radius: 3px;
        }
        .path-test {
            margin: 10px 0;
            padding: 10px;
            background: rgba(0,0,0,0.5);
            border-radius: 5px;
        }
        .log-output {
            background: #000;
            border: 1px solid #333;
            padding: 15px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
        .log-line {
            margin: 2px 0;
        }
        .fix-button {
            background: #28a745;
        }
        .fix-button:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ì˜¹ë²½ 3D ë·°ì–´ - ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</h1>
        
        <!-- 1. í™˜ê²½ ì²´í¬ -->
        <div class="test-section">
            <h2>1. í™˜ê²½ ë° ì˜ì¡´ì„± ì²´í¬</h2>
            <div id="environment-check"></div>
        </div>
        
        <!-- 2. CONFIG ì²´í¬ -->
        <div class="test-section">
            <h2>2. CONFIG ì„¤ì • ì²´í¬</h2>
            <div id="config-check"></div>
            <button onclick="showFullConfig()">ì „ì²´ CONFIG ë³´ê¸°</button>
            <button onclick="testConfigProxy()">CONFIG í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸</button>
        </div>
        
        <!-- 3. ê²½ë¡œ ì²´í¬ -->
        <div class="test-section">
            <h2>3. ëª¨ë¸ ê²½ë¡œ ì²´í¬</h2>
            <div id="path-check"></div>
            <button onclick="checkAllPaths()">ëª¨ë“  ê²½ë¡œ í™•ì¸</button>
            <button onclick="testModelLoad(0)">ì²« ë²ˆì§¸ ëª¨ë¸ ë¡œë“œ í…ŒìŠ¤íŠ¸</button>
        </div>
        
        <!-- 4. CSS ì²´í¬ -->
        <div class="test-section">
            <h2>4. CSS ë° ë ˆì´ì•„ì›ƒ ì²´í¬</h2>
            <div id="css-check"></div>
            <button onclick="checkCSS()">CSS íŒŒì¼ í™•ì¸</button>
            <button onclick="testLayout()">ë ˆì´ì•„ì›ƒ ìš”ì†Œ í™•ì¸</button>
        </div>
        
        <!-- 5. ì‹¤ì‹œê°„ ë¡œê·¸ -->
        <div class="test-section">
            <h2>5. ì‹¤ì‹œê°„ ë¡œê·¸</h2>
            <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
            <button onclick="runFullTest()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <button class="fix-button" onclick="applyFixes()">ğŸ”§ ë¬¸ì œ ìë™ ìˆ˜ì • ì‹œë„</button>
            <div id="log-output" class="log-output"></div>
        </div>
        
        <!-- ì¶œë ¥ ì˜ì—­ -->
        <div id="output"></div>
    </div>

    <!-- Three.js ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <!-- ì„¤ì • íŒŒì¼ë“¤ -->
    <script type="module">
        import { CONFIG_MANAGER, getConfig, setConfig } from './js/core/ConfigManager.js';
        import { CONFIG } from './js/config.js';
        
        // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
        window.CONFIG = CONFIG;
        window.CONFIG_MANAGER = CONFIG_MANAGER;
        window.getConfig = getConfig;
        window.setConfig = setConfig;
        
        // ë¡œê·¸ í•¨ìˆ˜
        const logOutput = document.getElementById('log-output');
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = `log-line ${type}`;
            line.innerHTML = `[${timestamp}] ${message}`;
            logOutput.appendChild(line);
            logOutput.scrollTop = logOutput.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        window.log = log;
        
        // 1. í™˜ê²½ ì²´í¬
        function checkEnvironment() {
            const envDiv = document.getElementById('environment-check');
            let html = '';
            
            // Three.js ì²´í¬
            const hasThree = typeof THREE !== 'undefined';
            html += `<p class="${hasThree ? 'success' : 'error'}">
                ${hasThree ? 'âœ“' : 'âœ—'} Three.js: ${hasThree ? `v${THREE.REVISION}` : 'ë¡œë“œë˜ì§€ ì•ŠìŒ'}
            </p>`;
            
            // GLTFLoader ì²´í¬
            const hasGLTFLoader = hasThree && typeof THREE.GLTFLoader !== 'undefined';
            html += `<p class="${hasGLTFLoader ? 'success' : 'error'}">
                ${hasGLTFLoader ? 'âœ“' : 'âœ—'} GLTFLoader: ${hasGLTFLoader ? 'ë¡œë“œë¨' : 'ë¡œë“œë˜ì§€ ì•ŠìŒ'}
            </p>`;
            
            // ConfigManager ì²´í¬
            const hasConfigManager = typeof CONFIG_MANAGER !== 'undefined';
            html += `<p class="${hasConfigManager ? 'success' : 'error'}">
                ${hasConfigManager ? 'âœ“' : 'âœ—'} ConfigManager: ${hasConfigManager ? `í™˜ê²½: ${CONFIG_MANAGER.environment}` : 'ë¡œë“œë˜ì§€ ì•ŠìŒ'}
            </p>`;
            
            // CONFIG ì²´í¬
            const hasConfig = typeof CONFIG !== 'undefined';
            html += `<p class="${hasConfig ? 'success' : 'error'}">
                ${hasConfig ? 'âœ“' : 'âœ—'} CONFIG: ${hasConfig ? 'ë¡œë“œë¨' : 'ë¡œë“œë˜ì§€ ì•ŠìŒ'}
            </p>`;
            
            envDiv.innerHTML = html;
            
            log('í™˜ê²½ ì²´í¬ ì™„ë£Œ', hasThree && hasGLTFLoader && hasConfigManager && hasConfig ? 'success' : 'error');
        }
        
        // 2. CONFIG ì²´í¬
        function checkConfig() {
            const configDiv = document.getElementById('config-check');
            let html = '';
            
            try {
                // ê¸°ì¡´ ë°©ì‹ í…ŒìŠ¤íŠ¸
                html += '<h3>ê¸°ì¡´ CONFIG ì ‘ê·¼:</h3>';
                html += `<p class="info">CONFIG.models: ${CONFIG.models ? `${CONFIG.models.length}ê°œ` : 'ì—†ìŒ'}</p>`;
                html += `<p class="info">CONFIG.modelsPath: ${CONFIG.modelsPath || 'ì—†ìŒ'}</p>`;
                html += `<p class="info">CONFIG.debug: ${CONFIG.debug}</p>`;
                
                // ìƒˆë¡œìš´ ë°©ì‹ í…ŒìŠ¤íŠ¸
                html += '<h3>ConfigManager ì ‘ê·¼:</h3>';
                html += `<p class="info">getConfig('models'): ${getConfig('models')?.length || 0}ê°œ</p>`;
                html += `<p class="info">getConfig('paths.modelsPath'): ${getConfig('paths.modelsPath')}</p>`;
                html += `<p class="info">getConfig('app.debug'): ${getConfig('app.debug')}</p>`;
                
                configDiv.innerHTML = html;
                log('CONFIG ì²´í¬ ì™„ë£Œ', 'success');
            } catch (error) {
                configDiv.innerHTML = `<p class="error">CONFIG ì²´í¬ ì‹¤íŒ¨: ${error.message}</p>`;
                log(`CONFIG ì²´í¬ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // 3. ê²½ë¡œ ì²´í¬
        async function checkPaths() {
            const pathDiv = document.getElementById('path-check');
            let html = '<h3>ëª¨ë¸ íŒŒì¼ ê²½ë¡œ:</h3>';
            
            const models = CONFIG.models || [];
            const basePath = CONFIG.modelsPath || getConfig('paths.modelsPath');
            
            for (let i = 0; i < models.length; i++) {
                const model = models[i];
                const fullPath = `${basePath}${model.folder}/${model.fileName}`;
                
                html += `<div class="path-test">
                    <strong>${i + 1}. ${model.name}</strong><br>
                    <code>${fullPath}</code><br>
                    <span id="path-status-${i}">í™•ì¸ ì¤‘...</span>
                </div>`;
            }
            
            pathDiv.innerHTML = html;
            
            // ë¹„ë™ê¸°ë¡œ íŒŒì¼ ì¡´ì¬ í™•ì¸
            for (let i = 0; i < models.length; i++) {
                const model = models[i];
                const fullPath = `${basePath}${model.folder}/${model.fileName}`;
                const statusEl = document.getElementById(`path-status-${i}`);
                
                try {
                    const response = await fetch(fullPath, { method: 'HEAD' });
                    if (response.ok) {
                        statusEl.innerHTML = '<span class="success">âœ“ íŒŒì¼ ì¡´ì¬</span>';
                        log(`${model.name}: íŒŒì¼ í™•ì¸ë¨`, 'success');
                    } else {
                        statusEl.innerHTML = `<span class="error">âœ— íŒŒì¼ ì—†ìŒ (${response.status})</span>`;
                        log(`${model.name}: íŒŒì¼ ì—†ìŒ (${response.status})`, 'error');
                    }
                } catch (error) {
                    statusEl.innerHTML = '<span class="error">âœ— ì ‘ê·¼ ì‹¤íŒ¨</span>';
                    log(`${model.name}: ì ‘ê·¼ ì‹¤íŒ¨ - ${error.message}`, 'error');
                }
            }
        }
        
        // CONFIG í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸
        window.testConfigProxy = function() {
            log('=== CONFIG í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸ ===', 'info');
            
            // ì½ê¸° í…ŒìŠ¤íŠ¸
            log(`CONFIG.modelsPath: ${CONFIG.modelsPath}`, 'info');
            log(`CONFIG.camera.fov: ${CONFIG.camera.fov}`, 'info');
            log(`CONFIG.lights.ambient.intensity: ${CONFIG.lights.ambient.intensity}`, 'info');
            
            // ì“°ê¸° í…ŒìŠ¤íŠ¸
            const oldDebug = CONFIG.debug;
            CONFIG.debug = !oldDebug;
            log(`CONFIG.debug ë³€ê²½: ${oldDebug} â†’ ${CONFIG.debug}`, 'info');
            log(`getConfig('app.debug'): ${getConfig('app.debug')}`, 'info');
            
            alert('ì½˜ì†”ì—ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
        };
        
        // ì „ì²´ CONFIG ë³´ê¸°
        window.showFullConfig = function() {
            const output = document.getElementById('output');
            output.innerHTML = `
                <div class="test-section">
                    <h2>ì „ì²´ CONFIG ë‚´ìš©</h2>
                    <h3>CONFIG ê°ì²´:</h3>
                    <pre>${JSON.stringify(CONFIG, null, 2)}</pre>
                    <h3>ConfigManager ì „ì²´:</h3>
                    <pre>${JSON.stringify(CONFIG_MANAGER.getAll(), null, 2)}</pre>
                </div>
            `;
        };
        
        // ëª¨ë“  ê²½ë¡œ í™•ì¸
        window.checkAllPaths = async function() {
            await checkPaths();
        };
        
        // ëª¨ë¸ ë¡œë“œ í…ŒìŠ¤íŠ¸
        window.testModelLoad = function(index) {
            log(`=== ëª¨ë¸ ${index} ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===`, 'info');
            
            const model = CONFIG.models[index];
            if (!model) {
                log('ëª¨ë¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const basePath = CONFIG.modelsPath || getConfig('paths.modelsPath');
            const fullPath = `${basePath}${model.folder}/${model.fileName}`;
            
            log(`ëª¨ë¸: ${model.name}`, 'info');
            log(`ê²½ë¡œ: ${fullPath}`, 'info');
            
            const loader = new THREE.GLTFLoader();
            const startTime = performance.now();
            
            loader.load(
                fullPath,
                (gltf) => {
                    const loadTime = ((performance.now() - startTime) / 1000).toFixed(2);
                    log(`âœ“ ëª¨ë¸ ë¡œë“œ ì„±ê³µ! (${loadTime}ì´ˆ)`, 'success');
                    log(`  - ì• ë‹ˆë©”ì´ì…˜: ${gltf.animations.length}ê°œ`, 'info');
                    log(`  - ì”¬: ${gltf.scenes.length}ê°œ`, 'info');
                    log(`  - ì¹´ë©”ë¼: ${gltf.cameras.length}ê°œ`, 'info');
                    
                    // ê°„ë‹¨í•œ 3D ë·° ìƒì„±
                    createQuickView(gltf);
                },
                (xhr) => {
                    if (xhr.lengthComputable) {
                        const percent = (xhr.loaded / xhr.total * 100).toFixed(1);
                        log(`ë¡œë”© ì¤‘... ${percent}%`, 'info');
                    }
                },
                (error) => {
                    log(`âœ— ëª¨ë¸ ë¡œë“œ ì‹¤íŒ¨: ${error}`, 'error');
                }
            );
        };
        
        // ê°„ë‹¨í•œ 3D ë·° ìƒì„±
        function createQuickView(gltf) {
            const output = document.getElementById('output');
            output.innerHTML = `
                <div class="test-section">
                    <h2>3D ë¯¸ë¦¬ë³´ê¸°</h2>
                    <div id="three-canvas" style="width: 100%; height: 400px; background: #000;"></div>
                </div>
            `;
            
            const container = document.getElementById('three-canvas');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            
            // ì¡°ëª… ì¶”ê°€
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            scene.add(directionalLight);
            
            // ëª¨ë¸ ì¶”ê°€
            scene.add(gltf.scene);
            
            // ì¹´ë©”ë¼ ìœ„ì¹˜ ì¡°ì •
            const box = new THREE.Box3().setFromObject(gltf.scene);
            const center = box.getCenter(new THREE.Vector3());
            const size = box.getSize(new THREE.Vector3());
            const maxDim = Math.max(size.x, size.y, size.z);
            
            camera.position.set(maxDim, maxDim, maxDim);
            camera.lookAt(center);
            
            // ë Œë”ë§
            function animate() {
                requestAnimationFrame(animate);
                gltf.scene.rotation.y += 0.01;
                renderer.render(scene, camera);
            }
            animate();
            
            log('3D ë¯¸ë¦¬ë³´ê¸° ìƒì„±ë¨', 'success');
        }
        
        // CSS ì²´í¬
        window.checkCSS = async function() {
            const cssDiv = document.getElementById('css-check');
            const cssFiles = [
                'css/main.css',
                'css/main-improved.css'
            ];
            
            let html = '<h3>CSS íŒŒì¼ ìƒíƒœ:</h3>';
            
            for (const file of cssFiles) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    const status = response.ok ? 
                        '<span class="success">âœ“ ë¡œë“œë¨</span>' : 
                        `<span class="error">âœ— ì˜¤ë¥˜ (${response.status})</span>`;
                    html += `<p>${file}: ${status}</p>`;
                    log(`CSS ${file}: ${response.ok ? 'ë¡œë“œë¨' : `ì˜¤ë¥˜ ${response.status}`}`, response.ok ? 'success' : 'error');
                } catch (error) {
                    html += `<p>${file}: <span class="error">âœ— ì ‘ê·¼ ì‹¤íŒ¨</span></p>`;
                    log(`CSS ${file}: ì ‘ê·¼ ì‹¤íŒ¨`, 'error');
                }
            }
            
            cssDiv.innerHTML = html;
        };
        
        // ë ˆì´ì•„ì›ƒ ì²´í¬
        window.testLayout = function() {
            const elements = [
                'app-header', 'viewer-container', 'canvas-container',
                'model-selector', 'loading', 'error', 'right-panel',
                'bottom-controls', 'info-panel'
            ];
            
            log('=== ë ˆì´ì•„ì›ƒ ìš”ì†Œ ì²´í¬ ===', 'info');
            
            elements.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    log(`âœ“ #${id} ì¡´ì¬`, 'success');
                } else {
                    log(`âœ— #${id} ì—†ìŒ`, 'warning');
                }
            });
        };
        
        // ë¡œê·¸ ì§€ìš°ê¸°
        window.clearLog = function() {
            logOutput.innerHTML = '';
            console.clear();
        };
        
        // ì „ì²´ í…ŒìŠ¤íŠ¸
        window.runFullTest = async function() {
            clearLog();
            log('=== ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'info');
            
            checkEnvironment();
            checkConfig();
            await checkPaths();
            await checkCSS();
            
            log('=== ì „ì²´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===', 'info');
        };
        
        // ë¬¸ì œ ìë™ ìˆ˜ì •
        window.applyFixes = function() {
            log('=== ìë™ ìˆ˜ì • ì‹œì‘ ===', 'warning');
            
            // 1. modelsPath ìˆ˜ì •
            if (!CONFIG.modelsPath && getConfig('paths.modelsPath')) {
                CONFIG.modelsPath = getConfig('paths.modelsPath');
                log('âœ“ CONFIG.modelsPath ì„¤ì •ë¨', 'success');
            }
            
            // 2. Three.js ì¬ë¡œë“œ ì‹œë„
            if (typeof THREE === 'undefined') {
                log('Three.js ì¬ë¡œë“œ ì‹œë„...', 'warning');
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js';
                script.onload = () => {
                    log('âœ“ Three.js ì¬ë¡œë“œ ì„±ê³µ', 'success');
                };
                document.head.appendChild(script);
            }
            
            log('=== ìë™ ìˆ˜ì • ì™„ë£Œ ===', 'warning');
            log('í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë³€ê²½ì‚¬í•­ì„ ì ìš©í•˜ì„¸ìš”.', 'info');
        };
        
        // ì´ˆê¸° ì‹¤í–‰
        window.addEventListener('load', () => {
            checkEnvironment();
            checkConfig();
            checkPaths();
            log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ. í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”.', 'info');
        });
    </script>
</body>
</html>